<!DOCTYPE html>
<html lang="en-US">
<head>
  <title>Distortions User Interface</title>
  <base href="../">
  <meta charset="UTF-8">

  <link rel="stylesheet" href="gui/grid-outer.css">
  <link rel="stylesheet" href="gui/other.css">

  <script type="application/javascript"
          src="gui/utilities/defineElementGetter.js"
         ></script>
  <script type="application/javascript"
          src="gui/utilities/stylesheet.js"></script>
  <script type="application/javascript"
          src="gui/utilities/promiseTypes.js"></script>

  <link rel="stylesheet" href="gui/tree/tree.css">
  <script type="application/javascript"
          src="gui/tree/tree.js"></script>

  <link rel="stylesheet" href="gui/help.css">

  <script type="application/javascript"
          src="gui/DistortionsGUI.js"></script>
  <script type="application/javascript"
          src="gui/OuterGridManager.js"></script>
  <script type="application/javascript"
          src="gui/DistortionsRules.js"></script>

  <!-- load panel -->
  <link rel="stylesheet" href="gui/mainPanels/load.css">
  <script type="application/javascript"
          src="gui/mainPanels/load.js"></script>

  <!-- membrane panel -->
  <link rel="stylesheet" href="gui/mainPanels/membrane.css">
  <script type="application/javascript"
          src="gui/mainPanels/membrane.js"></script>
  <script type="application/javascript"
          src="gui/HandlerNames.js"></script>

  <!-- rules panels -->
  <link rel="stylesheet" href="gui/mainPanels/rules.css">

  <!-- output panel -->
  <script type="application/javascript"
          src="gui/mainPanels/output.js"></script>

  <!-- object graph management panels -->
  <script type="application/javascript"
          src="gui/mainPanels/graphs.js"></script>

  <!-- Multistate button for truncateArgList, in #grid-outer-mainpanels -->
  <link rel="stylesheet" href="gui/multistate/multistate.css">
  <script type="application/javascript"
          src="gui/multistate/multistate.js"></script>

  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/lib/codemirror.js"></script>
  <link rel="stylesheet"
        href="libraries/codemirror-5.25.2/lib/codemirror.css">
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/foldcode.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/foldgutter.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/brace-fold.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/comment-fold.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/indent-fold.js"></script>
  <link rel="stylesheet"
        href="libraries/codemirror-5.25.2/addon/fold/foldgutter.css">
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/mode/javascript/javascript.js"></script>

  <script type="application/javascript"
          src="gui/utilities/CodeMirrorManager.js"
         ></script>

  <script type="application/javascript"
          defer="defer"
          src="libraries/jszip.min.js"
         ></script>
</head>

<body>
  <form action="javascript:void(null);" id="tabbox-form"></form>
  <div id="grid-outer">
    <!-- row 1, 2 -->
    <div id="tabbox-files-cell">
      <!-- tabbox-files-cell occupies two horizontal cells in grid-outer -->

      <div id="tabbox-files" class="tabbar">
        <!-- tabbox-files defines its own grid.
             row 1 is for object graph handlers by name, which is how tabs are grouped.
          -->

        <!-- row 2 -->
        <input type="radio" name="files" checked="checked" form="tabbox-form"
               value="load" id="tabbox-files-load"/>
        <label for="tabbox-files-load">
          <strong>Load</strong>
        </label>

        <input type="radio" name="files" form="tabbox-form"
               value="membrane" id="tabbox-files-membrane"/>
        <label for="tabbox-files-membrane">
          <strong>Membrane</strong>
        </label>

        <span>&nbsp;</span>

        <span class="insertPoint">&nbsp;</span>
        <input type="radio" name="files" disabled="disabled" form="tabbox-form"
               value="output" id="tabbox-files-output">
        <label for="tabbox-files-output">
          <strong>Output</strong>
        </label>
      </div>
    </div>
    <span><!-- this element intentionally left blank --></span>

    <!-- row 3 -->
    <div id="grid-outer-mainpanels" filesTab="start">
      <section class="loadPanel">
        <h2>Start here</h2>
        <form id="grid-outer-load-configform"
              method="post"
              enctype="multipart/form-data"
              action="javascript:void();">
          <span>
            <label for="grid-outer-load-config-input">
              If you have a Distortions GUI configuration file already, please
              select it here:
            </label>
            <br>
            <input id="grid-outer-load-config-input"
                   type="file"
                   value=""
                   name="config"
                   accept="application/json"
                   required="required"
                   onchange="void(window.LoadPanel.update('fromConfig'));"
                  >
          </span>
          <hr>
        </form>

        <form id="grid-outer-load-zipform">
          <span>
            <label for="grid-outer-load-zipfile">
              Specify a zip file containing your JavaScript files.
            </label>
            <input id="grid-outer-load-zipfile"
                   type="file"
                   name="zipfile"
                   required="required"
                   accept="application/zip"
                   onchange="void(window.LoadPanel.update('fromZip'));"
                  />
          </span>
        </form>

        <form id="grid-outer-load-filesform">
          <span>
            <label for="grid-outer-load-location">
              Or specify common source JavaScript files to include here.
            </label>

            <br>
            <input id="grid-outer-load-location"
                   type="file"
                   multiple="multiple"
                   value=""
                   name="location"
                   required="required"
                   accept="application/javascript"
                   onchange="void(window.LoadPanel.update('fromFlatFiles'));"
                  >
          </span>
          <hr>
        </form>

        <!-- A simple file-ordering grid.  No display:contents. -->
        <div id="grid-outer-load-fileorder" class="hidden"></div>

        <p>When you have selected all the files you need to set up your script
        environment, please select the Membrane tab above to begin configuring
        your membrane.</p>
      </section>

      <section class="membranePanel">
        <form id="grid-outer-membrane-configForm"
              method="post"
              enctype="multipart/form-data"
              action="javascript:void(OuterGridManager.defineGraphs());">
          <div>
            <label>
              <input type="checkbox" id="grid-outer-membrane-enablePT">
              Enable pass-through function.
            </label>
          </div>
          <br>
          <div>
            <label>
              <input type="checkbox" id="grid-outer-membrane-primordials">
              The membrane should ignore primordials (Object, Function, Array,
              etc.), and their prototypes.
            </label>
          </div>
          <br>
          <div>
            <label for="grid-outer-membrane-passthrough">
              Pass-through function source:
            </label>
            <br>
            <textarea id="grid-outer-membrane-passthrough">const PassThroughFilter = (function() {
  const items = [];

  {
    const s = new Set(items);
    return s.has.bind(s);
  }
})();
</textarea>
          </div>
          <br>

          <p>Name the object graphs you want here.  This is an ordered set for
          the configuration files that interact with this tool and the Membrane
          constructor.</p>
          <p>(Examples:  [internal, public] or [wet, dry].)</p>
          <div id="grid-outer-membrane-objectgraphs">
            <button class="icon addRow" onclick="HandlerNames.addRow();"></button>
          </div>

          <button type="submit"
                  id="grid-outer-membrane-graphnames-submit">
            Continue
          </button>

          <button type="button"
                  onclick="void(window.MembranePanel.reset());">
            Reset from loaded configuration
          </button>
          <input type="hidden"
                 id="grid-outer-membrane-graphnames-validity"
                />
        </form>
      </section>

      <section class="output">
        <h2>Generated output</h2>
        <p>This panel contains two outputs:  a Distortions GUI configuration
        file, and a generated JavaScript file to initialize your
        Membrane.  I recommend committing both files to your project repository.
        </p>
        <div id="grid-outer-output-error"></div>

        <hr>
        <div>
          <label>
            <a id="grid-outer-output-config-download"
               download="membrane-distortions-gui.json">
              Download configuration
            </a>
          </label>
          <textarea id="grid-outer-output-configuration"></textarea>
        </div>

        <hr>
        <div>
          <label>
            <a id="grid-outer-output-js-download"
               download="build-membrane.js">
              Download membrane initialization file
            </a>
          </label>
          <textarea id="grid-outer-output-javascript"></textarea>
        </div>
      </section>
      <!-- this is where <section> elements containing the distortions UI for
      individual values will live.  -->
    </div>

    <div id="help-and-notes">
      <!-- This space holds two different kinds of panel:
        (1) help text explaining the proxy traps and how disabling them affects
        the proxy to the value,
        (2) HTML textareas (possibly editable HTML areas) for the user to write
        their own notes.
      -->

      <article id="help-proxy-getPrototypeOf">
        <h2>getPrototypeOf()</h2>
        <h3>Summary</h3>
        <p>The getPrototypeOf() trap
          <a title="Reflect.getPrototypeOf() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/getPrototypeOf"
             target="_blank"
             rel="noopener">"returns the prototype (i.e. the value of the
             internal <code>[[Prototype]]</code> property) of the specified
             object."</a></p>
        <h3>Examples</h3>
        <p>In JavaScript, it's very common to have a constructor function with
        methods defined on the prototype property of the function:</p>
        <pre>function Rectangle(width, height) {
  this.width = width;
  this.height = height;
}
Rectangle.prototype.getArea = function() {
  return this.width * this.height;
};

var r = new Rectangle(3, 4);
r.getArea(); // returns 12</pre>
        <p>The prototype of <code>r</code> in this case is Rectangle.prototype.</p>
        <pre>Reflect.getPrototypeOf(r) === Rectangle.prototype;
// returns true</pre>
        <p>The <code>getArea()</code> method is available to the <code>r</code>
          object because it inherits from
          <code>Rectangle.prototype</code>.</p>
        <h3>Usage in es-membrane</h3>
        <p>I do not recommend disabling the getPrototypeOf() trap, because
        prototypes are central to the normal operation of JavaScript.&nbsp;
        Currently, it throws an exception when disabled.</p>
        <h4>Coming soon</h4>
        <p>When the getPrototypeOf() trap is disabled, it will return null to indicate there is no prototype available.</p>
        <p>
          <a title="Reflect.getPrototypeOf() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/getPrototypeOf"
             target="_blank"
             rel="noopener">Reflect.getPrototypeOf()</a>
          by
          <a href="https://developer.mozilla.org/en-US/docs/MDN/About$history">
            Mozilla Contributors
          </a>
          is licensed under
          <a class="external external-icon"
             href="http://creativecommons.org/licenses/by-sa/2.5/">CC-BY-SA 2.5</a>
          .
        </p>
      </article>

      <article id="help-proxy-setPrototypeOf">
        <h2>setPrototypeOf()</h2>
        <h3>Summary</h3>
        <p>The setPrototypeOf() trap
          <a title="Reflect.setPrototypeOf() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/setPrototypeOf"
             target="_blank"
             rel="noopener">"sets the prototype (i.e., the internal
             <code>[[Prototype]]</code> property) of a specified object to
             another object or to null."</a></p>
        <h3>Examples</h3>
        <p>In JavaScript, it's very common to have a constructor function with
        methods defined on the prototype property of the function:</p>
        <pre>function Rectangle(width, height) {
  this.width = width;
  this.height = height;
}
Rectangle.prototype.getArea = function() {
  return this.width * this.height;
};

var r = new Rectangle(3, 4);
r.getArea(); // returns 12</pre>
        <p>The prototype of <code>r</code> in this case is Rectangle.prototype.
        The <code>getArea()</code> method is available to the <code>r</code>
        object because it inherits from <code>Rectangle.prototype</code>.</p>
        <p><em>Setting</em> the prototype means altering all the inherited
        properties of the object you're inspecting:</p>
        <pre>function Rectangle(width, height) {
  this.width = width;
  this.height = height;
}
Rectangle.prototype.getArea = function() {
  return this.width * this.height;
};

var r = new Rectangle(3, 4);

const newProto = {
  getPerimeter: function() {
    return (this.width + this.height) * 2;
  }
};

Reflect.setPrototypeOf(r, newProto);

r.getPerimeter(); // returns 14;

try {
  r.getArea(); // throws TypeError: r.getArea is not a function
}
catch (e) {
  // do nothing
}
  
Reflect.setPrototypeOf(newProto, Rectangle.prototype);
  
r.getArea(); // returns 12</pre>
        <h3>Usage in es-membrane</h3>
        <p>I strongly recommend disabling the setPrototypeOf() trap, because
        anyone who sets a prototype on your objects effectively owns all the
        inherited properties of your objects.  For this reason, the
        setPrototypeOf() trap is not checked by default.</p>
        <p>
          <a title="Reflect.setPrototypeOf() - JavaScript | MDN"
               href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/setPrototypeOf"
               target="_blank"
               rel="noopener">
            Reflect.setPrototypeOf()
          </a>
          by
          <a class="new"
             href="https://developer.mozilla.org/en-US/docs/MDN/About$history">
            Mozilla Contributors
          </a>
          is licensed under
          <a class="external external-icon"
             href="http://creativecommons.org/licenses/by-sa/2.5/">
            CC-BY-SA 2.5
          </a>
        .</p>
      </article>

      <article id="help-proxy-isExtensible">
        <h2>isExtensible()</h2>
        <h3>Summary</h3>
        <p>The isExtensible() trap
          <a title="Reflect.isExtensible() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/isExtensible"
             target="_blank"
             rel="noopener">"determines if an object is extensible (whether it
             can have new properties added to it). It is similar to
             Object.isExtensible(), but with some differences."</a></p>
        <h3>Usage in es-membrane</h3>
        <p>I strongly recommend enabling the isExtensible trap.  A lot of the
        ECMAScript specification relies on isExtensible returning true or false.
        Disabling the trap currently means that any call to a proxy's
        isExtensible internal property will throw an exception.  I don't know
        how JavaScript engines respond to an exception being thrown from such a
        call, but I guarantee it won't be pretty.  It could even lead to
        inconsistent behavior...</p>
        <p><strong>Help wanted:</strong> Let me know your educated opinion on 
        how a membrane should handle at disabled isExtensible trap
          <a href="https://github.com/ajvincent/es-membrane/issues/101">here</a>
        .</p>
      </article>

      <article id="help-proxy-preventExtensions">
        <h2>preventExtensions()</h2>
        <h3>Summary</h3>
        <p>The preventExtensions() trap
          <a title="Object.preventExtensions() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions"
             target="_blank"
             rel="noopener">"prevents new properties from ever being added to an
             object (i.e. prevents future extensions to the object)."</a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>I strongly recommend disabling the preventExtensions trap.  If an
        untrusted person can call preventExtensions, that means your protected
        objects may break when you try to define new properties.</p>

        <p>Additionally, you may want to enable the storeUnknownAsLocal setting,
        so untrusted users' unique properties do not propagate across to your
        trusted code.</p>
      </article>

      <article id="help-proxy-getOwnPropertyDescriptor">
        <h2>getOwnPropertyDescriptor()</h2>
        <h3>Summary</h3>
        <p>The getOwnPropertyDescriptor() trap
          <a title="Object.getOwnPropertyDescriptor() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor"
             target="_blank"
             rel="noopener">"returns a property descriptor for an own
             property (that is, one directly present on an object and not in the
             object's prototype chain) of a given object."</a>
        </p>
        <p>See
          <a title="Object.defineProperty() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty#Description"
             target="_blank"
             rel="noopener">
            the "defineProperty" Description section at MDN
          </a>
          for examples of property descriptors.
        </p>
        <h3>Usage in es-membrane</h3>
        <p>I strongly recommend enabling the getOwnPropertyDescriptor() trap.
        The get() trap relies on the getOwnPropertyDescriptor() trap, and will
        not work without it.</p>
        <p><strong>Advice wanted:</strong> It's unclear what the "right"
        behavior should be if the user disables this trap.  Currently, the
        Membrane throws an exception.  It may be better to simply return
        undefined.</p>
      </article>

      <article id="help-proxy-defineProperty">
        <h2>defineProperty()</h2>
        <h3>Summary</h3>
        <p>The defineProperty() trap
          <a title="Object.defineProperty() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"
             target="_blank"
             rel="noopener">"defines a new property directly on an object, or
             modifies an existing property on an object"</a> and returns a
             boolean: true if the operation was successful, false otherwise.
        </p>
        <p>See the "Description" section in the "defineProperty" page for a good
        explanation about property descriptors.</p>
        <h3>Usage in es-membrane</h3>
        <p>For now, I recommend enabling the defineProperty() trap.  First, the
        set() trap relies on the defineProperty() trap.</p>
        <p>Second, the defineProperty() trap is universal:  applying to all
        properties.  If you really wish to prevent someone from re-defining a
        specific property, you're probably better off setting the
        [[Configurable]] field of the property descriptor to false, and either
        setting [[Writable]] to false or removing the [[Set]] field.
        </p>
        <p>At this time, the Membrane library does not directly allow for
        specifying certain properties as read-only to one graph and read-write
        to another.  You may be able to achieve this feature through a
        ChainHandler (which is not supported by this configuration tool).  
        Remember the original object sets its own rules for access, which
        the Membrane library currently follows.</p>
      </article>

      <article id="help-proxy-has">
        <h2>has()</h2>
        <h3>Summary</h3>
        <p>The has() trap
          <a title="Reflect.has() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/has"
             target="_blank"
             rel="noopener">"works like the in operator as a function."</a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>I recommend enabling the has() trap.  There's really no reason to
        disable it.</p>
        <p><strong>Advice wanted:</strong> It's unclear what the "right"
        behavior should be if the user disables this trap.  Currently, the
        Membrane throws an exception.  It may be better to simply return
        false.</p>
        <p>In particular, you should be aware of the possibility for
        unexpected behavior if the has() trap is enabled and the get() trap is
        disabled, or vice-versa.</p>
      </article>

      <article id="help-proxy-get">
        <h2>get()</h2>
        <h3>Summary</h3>
        <p>The get() trap
          <a title="Reflect.get() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/get"
             target="_blank"
             rel="noopener">
            "works like getting a property from an object (target[propertyKey])
             as a function."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>Getting a property of an object is one of the most fundamental
        operations in JavaScript.  Disabling this trap for any objects will make
        those objects essentially useless, if not worse.  (By "worse", I mean
        the throwing of exceptions at property lookup.)</p>
        <p><strong>Advice wanted:</strong> It's unclear what the "right"
        behavior should be if the user disables this trap.  Currently, the
        Membrane throws an exception.  It may be better to simply return
        undefined.</p>
        <p>In particular, you should be aware of the possibility for
        unexpected behavior if the has() trap is enabled and the get() trap is
        disabled, or vice-versa.</p>
      </article>

      <article id="help-proxy-set">
        <h2>set()</h2>
        <h3>Summary</h3>
        <p>The set() trap
          <a title="Reflect.set() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set"
             target="_blank"
             rel="noopener">
            "works like setting a property on an object."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>If you disable this trap on an object's proxy, then any attempt to
        set properties via that proxy will throw an exception.</p>
        <p>Personally, I think disabling this trap is an inappropriate solution
        to preventing users from modifying your objects (although it certainly
        is effective, and universal).  You may be better off with specific
        property descriptors, and/or filtering of own keys.</p>
        <p>In particular, keep in mind that users often want to set their own
        properties which you as a developer may never have considered.  In that
        case, it's better to enable the "storeUnknownAsLocal" setting (shown as
        "Local properties" in the rules configuration panel), so untrusted
        users' unique properties do not propagate across to your trusted code.
        </p>
      </article>

      <article id="help-proxy-deleteProperty">
        <h2>deleteProperty()</h2>
        <h3>Summary</h3>
        <p>The deleteProperty() trap
          <a title="Reflect.deleteProperty() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/deleteProperty"
             target="_blank"
             rel="noopener">
            "allows to delete properties. It is like the delete operator as a
             function."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>If you disable this trap on an object's proxy, then any attempt to
        delete properties via that proxy will throw an exception.</p>
        <p>Personally, I think disabling this trap is an inappropriate solution
        to preventing users from removing properties from your objects (although
        it certainly is effective, and universal).</p>
        <p>The "requireLocalDelete" flag (shown as "Local deletes" in the
        rules configuration panel) exists specifically to handle this case,
        where a property may be "deleted" from a proxy, but that delete
        operation does <em>not</em> propagate across to the original object.</p>
        <p>If that is not sufficiently safe, you may be better off with specific
        property descriptors, particularly with the [[Configurable]] field set
        to false.</p>
      </article>

      <article id="help-proxy-ownKeys">
        <h2>ownKeys()</h2>
        <h3>Summary</h3>
        <p>The ownKeys() trap
          <a title="Reflect.ownKeys() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys"
             target="_blank"
             rel="noopener">
            "returns an array of the target object's own property keys."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>Internally, this method follows several steps:</p>
        <ul>
          <li>generating a list of known keys from the original object</li>
          <li>removing any keys the origin graph or target graph decide must be
          hidden (either by explicitly being deleted or being rejected by a
          filter function)</li>
          <li>appending the keys local to the origin graph (or, indirectly, the
          target graph)</li>
          <li>following the specification rules for configurable versus
          non-configurable properties</li>
        </ul>
        <p>I recommend enabling the ownKeys() trap.  There's really no reason to
        disable it.</p>
        <p><strong>Advice wanted:</strong> It's unclear what the "right"
        behavior should be if the user disables this trap.  Currently, the
        Membrane throws an exception.  It may be better to simply return
        an empty array.</p>
      </article>

      <article id="help-proxy-apply">
        <h2>apply()</h2>
        <h3>Summary</h3>
        <p>The apply() trap
          <a title="Reflect.apply() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/apply"
             target="_blank"
             rel="noopener">
            "calls a target function with arguments as specified."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>This is one case where disabling the trap is possibly a good idea.
        ECMAScript does not specify any good way of stating whether a function
        should be used exclusively as a constructor or exclusively as a method.
        Constructors typically should not be called as ordinary functions,
        and vice versa.  Proxies, such as those provided by a Membrane, are
        really the best way for enforcing a "constructor versus method"
        contract.</p>
        <p>If you intend your function to be a method, this trap should be
        enabled.  Otherwise, this trap should be disabled.</p>
        <p>Note that enabling/disabling this trap is not possible for
        non-function objects.  This is because non-function objects cannot use
        this trap.</p>
      </article>

      <article id="help-proxy-construct">
        <h2>construct()</h2>
        <h3>Summary</h3>
        <p>The construct() trap
          <a title="Reflect.construct() - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/construct"
             target="_blank"
             rel="noopener">
            "acts like the new operator as a function. It is equivalent to
             calling new target(...args)."
          </a>
        </p>
        <h3>Usage in es-membrane</h3>
        <p>This is one case where disabling the trap is possibly a good idea.
        ECMAScript does not specify any good way of stating whether a function
        should be used exclusively as a constructor or exclusively as a method.
        Constructors typically should not be called as ordinary functions,
        and vice versa.  Proxies, such as those provided by a Membrane, are
        really the best way for enforcing a "constructor versus method"
        contract.</p>
        <p>If you intend your function to be a constructor, this trap should be
        enabled.  Otherwise, this trap should be disabled.</p>
        <p>Note that enabling/disabling this trap is not possible for
        non-function objects.  This is because non-function objects cannot use
        this trap.</p>
      </article>

      <article id="help-distortions-filterOwnKeys">
        <h2>Filter own keys</h2>
        <h3>Usage in es-membrane</h3>
        <p>This section allows you to determine which properties of your
        underlying object are exposed through the proxy to the user.  Initially,
        when this page generates the panel for a given object, it
        requires sample code to generate the object.  This page then iterates
        over the existing list of properties to generate a checklist of property
        names to expose.</p>
        <p>By default, each property has its filtering checkbox checked.  This
        means whenever a property lookup for that name happens, if the property
        exists on the underlying object, the membrane will return that property
        (properly wrapped, of course).</p>
        <p>On the other hand, if a property name's checkbox is <em>not</em>
        checked, the property will not exist from the perspective of the proxy.
        Users may use that name to define their own properties, particularly if
        the "Local properties" checkbox is also checked.</p>

        <br>
        <p>Each property name also has an icon in its row, like this.
          <img src="gui/icons/notes-icon.svg"/>  Clicking on this icon opens a
          HTML textarea for you to use as a notepad for that property.
        </p>
        <p>To the right of this icon, you will also see a button with a "Go"
        link.  If the button is enabled, you may click on the button to define a
        "property group" in a HTML input.  You can then click on the "Go" link
        to visit this property group's distortions in the configuration tool.
        </p>

        <br>
        <p>The "Filter own keys" row also has a checkbox:  this is for enabling
        or disabling all filtering of own-keys as a group.  If you do not want
        any filtering of properties whatsoever, you should uncheck this box.</p>
        <p>In general, I recommend enabling this checkbox and unchecking any
        properties you do not wish to expose to users.  This feature is
        essential for white-listing of properties, in my opinion.</p>
        <br>
        <p>Finally, containers in general (Array, Map, Set, WeakMap, etc.) do
        not fit well within this model of hidden properties.  For instance, if I
        expose an Array, all its property names are really numbers.  I may want
        to hide element 2 of the unwrapped array from the wrapping object graph,
        but I do not want element 2 to be "undefined".  Instead, I'd rather the
        look-up operation for element 2 in the proxy return element 3
        of the actual array (wrapped properly), for instance.  This version of
        the Membrane library offers no direct support for this:  instead, you
        should implement custom ChainHandler instances for containers, when
        necessary.</p>
        <p>Sadly, ChainHandler objects are not supported by this configuration
        tool at this time.  (Figuring out a good user-interface for that is a
        challenge for another day.  Help is definitely invited on this subject.)
        </p>
      </article>

      <!-- transition to specific membrane features -->

      <article id="help-distortions-inheritFilter">
        <h2>Accept filter of own keys from prototype</h2>
        <h3>Usage in es-membrane</h3>
        <p>Sometimes a membrane will have a filter of "own keys" for an object's
        prototype.  Enabling this feature means the prototype's filters also
        apply to your list of own properties.</p>
        <p>Specifically, if either your primary filter or the prototype's filter
        accepts a property name, that property will be exposed through the traps
        of the Membrane.</p>
        <p>This should be considered as an optimization:  for common properties
        defined through a prototype chain, you should use a filter inherited
        through the prototype chain as well.</p>
        <p>For values that you pass through without wrapping in the membrane,
        there will naturally be no inherited filter, so you should not enable
        this distortion when the prototype is not wrapped.</p>
      </article>

      <article id="help-distortions-storeUnknownAsLocal">
        <h2>Local properties</h2>
        <h3>Usage in es-membrane</h3>
        <p>Users often want to set their own properties on values which you as a
        developer may never have considered.  However, if two or more object
        graphs rely on the same property name, then allowing each object graph
        to propagate new properties directly to the underlying object may be
        unwise.  The "local properties" flag exists for this reason:  to force
        each proxy to store new properties on the proxy but not on the target
        object.</p>
        <p>This works primarily through a Map() associated with each Membrane
        proxy, which stores the property name and descriptor.  When a look-up of
        the property name happens, the proxy will look at this Map object first.
        </p>
        
        <p>As a matter of preventing unexpected side-effects, and especially for
        preventing accidental overwriting of your private values, I recommend
        enabling this feature of the membrane proxy at all times.  This feature
        is essential for white-listing of properties, in my opinion.</p>
      </article>

      <article id="help-distortions-requireLocalDelete">
        <h2>Local deletes</h2>
        <h3>Usage in es-membrane</h3>
        <p>Suppose your customer calls delete on one of your object's properties
        that you rely on.  This is of course a potential disaster.  Disabling
        the delete trap is one option.  Another is to define the property
        descriptor on your prototypes with proper [[Configurable]] settings.
        The third option your Membrane provides is simply to delete the property
        <em>from the perspective of the proxy only.</em>  This feature is for
        that purpose.</p>
        
        <p>This works primarily through a Set() associated with each Membrane
        proxy, which stores each "deleted" property name.  When a look-up of the
        property name occurs, the proxy checks this set of names first.  If the
        set contains the name, the proxy acts as if the property does not exist.
        </p>

        <p>As a matter of preventing unexpected side-effects, and especially for
        preventing accidental deletion of your private values, I recommend
        enabling this feature of the membrane proxy at all times.  This feature
        is essential for white-listing of properties, in my opinion.</p>
      </article>

      <article id="help-distortions-truncateArgList">
        <h2>Argument list truncation</h2>
        <h3>Usage in es-membrane</h3>
        <p>Functions in JavaScript may have any number of arguments passed to
        them.  Each function defines a certain number of default arguments (its
        "arity"), but other than that, there's no hints externally as to what a
        function may have passed to it.</p>
        <p>Unfortunately, this opens a Membrane to attack by consuming lots of
        memory:  every single non-primitive argument potentially could need
        wrapping in the Membrane as at least one proxy <em>per object
        graph,</em> and that memory will persist until the target function call
        exits, at least, potentially until the object graph is destroyed or
        revoked.</p>
        <p>Therefore, as a basic security measure (validating the number of
        arguments), the Membrane offers you the option to limit the length of
        an argument list passed to the target function from a proxy.</p>
        <p>This control defines a three-state option, controlled first by a
        button and then by a number input.  When the button shows:</p>
        <ol>
          <li>"None", no argument count restriction exists</li>
          <li>"Arity", only the number of arguments your function defines will
          pass through</li>
          <li>"#:", only the number of arguments you specify in the number input
          will pass through</li>
        </ol>
        <p>This feature is disabled for non-functions (as it has no meaning
        then).</p>
        <p>Note that if the target function defines
          <a title="Rest parameters - JavaScript | MDN"
             href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters"
             target="_blank"
             rel="noopener">rest parameters</a>
          , this feature may be less useful at preventing excess arguments,
          especially in the "Arity" setting.  The Membrane library, and this
          configuration tool, has no way of detecting whether an argument is a
          rest parameter.
        </p>
      </article>

      <article id="help-distortions-useShadowTarget">
        <h2>Use shadow target</h2>
        <h3>Usage in es-membrane</h3>
        <p>JavaScript proxies tend to be somewhat heavyweight, and use a
        "shadow target" behind the scenes which, in theory, could duplicate the
        underlying object.  This relies on a couple of assumptions:</p>
        <ol>
          <li>The object's properties could be reliably copied when needed</li>
          <li>The shadow target would be lighter than the proxy in terms of
          performance</li>
        </ol>
        <p>The latter assumption, at least in testing, turns out to be false at
        this time.  For this reason, I cannot recommend enabling the "use shadow
        target" option.</p>

        <p><strong>Help wanted:</strong> If you can figure out why the shadow
        targets do not beat the proxies in performance, please let me know.</p>
      </article>
    </div>

    <div id="tabbox-function-traps" class="tabbar">
      <input type="radio"
             name="functionTraps"
             checked="checked"
             form="tabbox-form"
             value="value"
             id="tabbox-function-traps-value">
      <label for="tabbox-function-traps-value">Value</label>

      <input type="radio"
             name="functionTraps"
             form="tabbox-form"
             disabled="disabled"
             value="proto"
             id="tabbox-function-traps-prototype">
      <label for="tabbox-function-traps-prototype">Prototype</label>

      <input type="radio"
             name="functionTraps"
             form="tabbox-form"
             disabled="disabled"
             value="instance"
             id="tabbox-function-traps-instance">
      <label for="tabbox-function-traps-instance">Constructed By</label>
    </div>

    <!-- row 4 -->
    <output id="config-error"></output>
  </div>

  <template id="zipform-tree">
    <div class="gridtree" data-width="450px">
      <div class="treeroot">
        <ul>
          <li class="header">
            <span data-column-width="300px">File</span>
            <span data-column-width="150px">Load?</span>
          </li>
        </ul>
      </div>
    </div>
  </template>

  <template id="zipform-listitem">
    <li>
      <span></span>
      <span></span>
    </li>
  </template>

  <template id="fileorder-gridcells">
    <span></span>
    <button class="icon up"></button>
    <button class="icon down"></button>
  </template>

  <template id="objectgraph-main">
    <section>
      <form method="post"
            enctype="multipart/form-data"
            action="javascript:void();">
        <h2>Pass through values</h2>
        <div>
          <label>
            <input type="checkbox" class="enablePT">
            Enable pass-through function.
          </label>
        </div>
        <br>
        <div>
          <label>
            <input type="checkbox" class="ignore-primordials">
            The membrane should ignore primordials (Object, Function, Array,
            etc.), and their prototypes.
          </label>
        </div>
        <br>
        <div>
          <label>
            Pass-through function source:
          </label>
          <br>
          <textarea class="passThroughSource">const PassThroughFilter = (function() {
  const items = [];

  {
    const s = new Set(items);
    return s.has.bind(s);
  }
})();
</textarea>
        </div>
      </form>
  
      <form method="post"
            enctype="multipart/form-data"
            class="newValueForm"
            action="javascript:void(DistortionsGUI.buildValuePanel());">
        <h2>Add a function (or other object)</h2>
        <span>
          <label>
            How the code internally names the function or literal object.
          </label>
          <input class="nameOfValue"
                 type="text"
                 size="30"
                 required="required"
                />
        </span>
        <br>
  
        <div>
          <label>
            Return the function or literal object we will examine.
          </label>
          <textarea class="valueGetterSource">function() {
  return {};
}
</textarea>
        </div>
        <hr>
  
        <button type="submit">
          Build distortions
          <img src="gui/icons/plusicon.svg">
        </button>
        &nbsp;
        <button type="reset">
          Clear this panel
          <img src="gui/icons/minusicon.svg">
        </button>
      </form>
    </section>
  </template>

  <template id="objectgraph-name-row">
    <label>Symbol?<input type="checkbox" onchange="HandlerNames.update();"></label>
    <input type="text" size="10" required="required" onchange="HandlerNames.update();">
    <button class="icon deleteRow" disabled="disabled"
            onclick="HandlerNames.deleteRow(event);"></button>
  </template>

  <template id="distortions-tree-ui-main">
    <div class="gridtree" data-width="750px">
      <div class="treeroot">
        <ul>
          <li class="header">
            <span data-column-width="250px">Rule</span>
            <span data-column-width="120px">Enabled?</span>
            <span data-column-width="120px">Help / Notes</span>
            <span data-column-width="150px">Key's distortion</span>
          </li>
          <li class="collapsible">
            <span>Filter own keys</span>

            <!-- This checkbox is for folding the filterOwnKeys list -->
            <input type="checkbox" checked="checked" class="collapsible-check">

            <span>
              <!-- This checkbox is for enabling/disabling the filterOwnKeys rule. -->
              <input type="checkbox"
                     checked="checked"
                     class="filterOwnKeys-control"
                     data-name="filterOwnKeys"
                    >
            </span>
            <span>
              <button class="icon helpButton" data-for="distortions-filterOwnKeys"></button>
            </span>
            <ul data-group="ownKeys"></ul>
          </li>
    
          <li class="collapsible">
            <span>Proxy traps</span>
            <input type="checkbox" checked="checked" class="collapsible-check">
            <ul data-group="traps">
              <li>
                <span>getPrototypeOf</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-getPrototypeOf"></button>
                </span>
              </li>
              <li>
                <span>setPrototypeOf</span>
                <span><input type="checkbox"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-setPrototypeOf"></button>
                </span>
              </li>
              <li>
                <span>isExtensible</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-isExtensible"></button>
                </span>
              </li>
              <li>
                <span>preventExtensions</span>
                <span><input type="checkbox"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-preventExtensions"></button>
                </span>
              </li>
              <li>
                <span>getOwnPropertyDescriptor</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-getOwnPropertyDescriptor"></button>
                </span>
              </li>
              <li>
                <span>defineProperty</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-defineProperty"></button>
                </span>
              </li>
              <li>
                <span>has</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-has"></button>
                </span>
              </li>
              <li>
                <span>get</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-get"></button>
                </span>
              </li>
              <li>
                <span>set</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-set"></button>
                </span>
              </li>
              <li>
                <span>deleteProperty</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-deleteProperty"></button>
                </span>
              </li>
              <li>
                <span>ownKeys</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-ownKeys"></button>
                </span>
              </li>
              <li>
                <span>apply</span>
                <span><input type="checkbox" checked="checked" class="function-only"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-apply"></button>
                </span>
              </li>
              <li>
                <span>construct</span>
                <span><input type="checkbox" checked="checked" class="function-only"></span>
                <span>
                  <button class="icon helpButton" data-for="proxy-construct"></button>
                </span>
              </li>
            </ul>
          </li>
    
          <li class="collapsible">
            <span>Other distortions</span>
            <input type="checkbox" checked="checked" class="collapsible-check">
            <ul data-group="distortions">
              <li>
                <span data-name="inheritFilter"
                      title="Accept filter of own keys from prototype"
                     >Accept filter of own keys from prototype</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="distortions-inheritFilter"></button>
                </span>
              </li>
              <li>
                <span data-name="storeUnknownAsLocal">Local properties</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="distortions-storeUnknownAsLocal"></button>
                </span>
              </li>
              <li>
                <span data-name="requireLocalDelete">Local deletes</span>
                <span><input type="checkbox" checked="checked"></span>
                <span>
                  <button class="icon helpButton" data-for="distortions-requireLocalDelete"></button>
                </span>
              </li>
              <li>
                <span data-name="truncateArgList">Argument list truncation?</span>
                <span>
                  <button type="button" class="multistate function-only"
                          data-name="truncateArgList">
                    <span data-state="false">None</span>
                    <span data-state="true">Arity</span>
                    <span data-state="number">#:</span>
                  </button>
                  <input type="number" min="0" value="0" data-name="truncateArgMax"
                         disabled="disabled" style="width: 30px;"/>
                </span>
                <span>
                  <button class="icon helpButton" data-for="distortions-truncateArgList"></button>
                </span>
              </li>
              <li>
                <span data-name="useShadowTarget">Use shadow target</span>
                <span><input type="checkbox"></span>
                <span>
                  <button class="icon helpButton" data-for="distortions-useShadowTarget"></button>
                </span>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </template>

  <template id="distortions-tree-ui-property">
    <li>
      <span class="propertyName"></span>
      <span><input type="checkbox" checked="checked"></span>
      <span>
        <a href="javascript:void(null);" class="notesPanelLink">
          <img src="gui/icons/notes-icon.svg"/>
        </a>
      </span>
      <span>
        <button class="distortions-group"></button>
        <a href="javascript:void(null);">Go</a>
      </span>
    </li>
  </template>

  <template id="distortions-instanceof-prelude">
    <form method="post"
          enctype="multipart/form-data"
          class="newValueForm"
          action="javascript:void(DistortionsGUI.finishInstancePanel());">
      <h2>Add a function (or other object)</h2>
      <div>
        <label>
          Write a function which returns an example object which is a direct
          instance of this class.
        </label>
        <br>
        <textarea class="exampleSource">function() {
  const ctor = Object;
  return new ctor();
}
</textarea>
      </div>
      <hr>

      <button type="submit" class="submitButton">
        Build distortions
        <img src="gui/icons/plusicon.svg">
      </button>
      &nbsp;
      <button type="reset">
        Clear this panel
        <img src="gui/icons/minusicon.svg">
      </button>
    </form>

    <p>Defining custom distortions for properties of instances
    (<code>new Foo().bar</code>) is not supported at this time.  Instead, we
    recommend such properties be instances of other constructors, and
    configuring distortions for those instances.</p>
  </template>

  <template id="distortions-groups-panel-prelude">
    <p>Distortions for groups of values do not support selecting property keys
    for inclusion/exclusion.  If you list a value in this group, the
    filterOwnKeys rule is disabled for that value.</p>
    <hr/>
  </template>

  <div id="distortions-groups-dialog">
    <input type="text"
           id="distortions-groups-input"
           onkeyup="window.DistortionsRules.setDistortionGroup(event);"
           onblur="event.target.parentNode.classList.remove('visible');"
           pattern='\w*'
           list="distortions-groups-list">
  </div>
  <datalist id="distortions-groups-list">
    <option value="">(none)</option>
  </datalist>

  <div id="iframe-box">
    <iframe src="gui/blob/BlobLoader.html" id="BlobLoader"></iframe>
  </div>
  <div>
    <a href="gui/specification.html">Configuration file format specification</a>
  </div>
</body>
</html>
