<!DOCTYPE html>
<html>
<head>
  <title>Membrane Laboratory</title>
  <base href="../">
  <meta charset="UTF-8">

  <!-- CodeMirror -->
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/lib/codemirror.js"></script>
  <link rel="stylesheet"
        href="libraries/codemirror-5.25.2/lib/codemirror.css">
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/foldcode.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/foldgutter.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/brace-fold.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/comment-fold.js"></script>
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/addon/fold/indent-fold.js"></script>
  <link rel="stylesheet"
        href="libraries/codemirror-5.25.2/addon/fold/foldgutter.css">
  <script type="application/javascript"
          src="libraries/codemirror-5.25.2/mode/javascript/javascript.js"></script>

  <script type="application/javascript"
          src="lab/utilities/defineElementGetter.js"
         ></script>
  <script type="application/javascript"
          src="lab/utilities/ObjectGraphManager.js"
         ></script>
  <script type="application/javascript"
          src="lab/utilities/CodeMirrorManager.js"
         ></script>
  <script type="application/javascript"
          src="lab/utilities/TestDriver.js"
         ></script>
  <script type="application/javascript"
          src="lab/lab.js"
         ></script>
  <link rel="stylesheet" href="lab/lab.css">
</head>

<body>
  <aside>
    <form id="objectGraph-form" action="javascript:void();">
      <table id="objectGraphTable">
        <caption>
          Object graphs
        </caption>

        <thead>
          <tr>
            <td>Graph Name</td>
            <td>Symbol?</td>
            <td>Callback Name</td>
            <td>Commands</td>
          </tr>
        </thead>

        <tbody id="objectGraph-standardBody">
          <tr>
            <td>wet</td>
            <td>No</td>
            <td>withWetDoc</td>
            <td></td>
          </tr>
          <tr>
            <td>dry</td>
            <td>No</td>
            <td>withDryDoc</td>
            <td></td>
          </tr>
        </tbody>

        <!-- This is for custom object graph rows. -->
        <tbody id="objectGraph-customBody">
        </tbody>

        <template id="objectGraph-rowTemplate">
          <tr>
            <td><input type="text" size="6"></td>
            <td><input type="checkbox"></td>
            <td><input type="text" size="10" pattern="^[a-zA-Z$_][a-zA-Z0-9$_]*$"></td>
            <td><span>
              <button disabled="disabled"
                      onclick="ObjectGraphManager.moveUp(event);"
                     >&#x21E7;</button>
              <button disabled="disabled"
                      onclick="ObjectGraphManager.moveDown(event);"
                     >&#x21E9;</button>
              <button onclick="ObjectGraphManager.removeRow(event);"
                     >X</button>
            </span></td>
          </tr>
        </template>

        <tfoot>
          <tr>
            <td colspan="4"><span>
              <button onclick="ObjectGraphManager.addRow();"
                     >
                Add object graph
              </button>
              <!-- We will work on supporting this later. -->
            </span></td>
          </tr>
        </tfoot>
      </table>
    </form>

    <hr>
    <label for="TestDriver-DOMEnvironment">DOM Environment</label>
    <select id="TestDriver-DOMEnvironment">
      <option>JS-based DOM mocks</option>
      <!--
      <option>Actual XML DOM</option>
      -->
    </select>
    <hr>
    <label for="TestDriver-pageEnvironment">Test Environment</label>
    <select id="TestDriver-pageEnvironment">
      <option value="jasmine.html">Jasmine 2.5.2</option>
    </select>
  </aside>
  <section>
    <textarea readonly="true" id="CM-mockOptions" rows="10" cols="80">
/*
var Mocks = {
  wet: {
    doc: the wet document,
    Node: Node.prototype,
    Element: Element.prototype,
  },
  dry: {
    doc: Dry(Mocks.wet.doc),
    Node: Dry(Mocks.wet.Node),
    Element: Dry(Mocks.wet.Element),
  },

  membrane: the membrane
};
*/
const mockOptions = {
  wetHandlerCreated: function(wetHandler, Mocks)
  {
    /* called after the membrane's wet object graph is created, but before
       the wet objects are added to Mocks.
    */
  },
  dryHandlerCreated: function(dryHandler, Mocks)
  {
    /* called after the membrane's dry object graph is created, but before
       the dry objects are added to Mocks.
    */
  },
  /*
  postMembrane: function(Mocks, ...customGraphNames)
  {
    // called after Mocks is fully built out but before returning from
    // the buildMembrane() invocation.
    let membrane = Mocks.membrane;
  }
  */
};
    </textarea>
    <hr>
    <textarea readonly="true" id="CM-runMembraneTest" rows="20" cols="80">
function defineTests(buildMembrane, withWetDoc, withDryDoc)
{
  describe("A document has node type 9", function() {
    beforeEach(buildMembrane);

    it("in the wet graph.", function() {
      withWetDoc(function(document) {
        expect(document.nodeType).toBe(9);
      });
    });

    it("in the dry graph.", function() {
      withDryDoc(function(document) {
        expect(document.nodeType).toBe(9);
      });
    });
  });
};
    </textarea>
    <hr>
    <button onclick="TestDriver.run(['CM-mockOptions', 'CM-runMembraneTest']);"
            id="TestDriver-runButton">
      Run the test
    </button>
    <br>
    <iframe src="lab/error.html" id="TestDriver-iframe"></iframe>
  </section>
</body>
</html>
